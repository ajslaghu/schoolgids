Classifying text with RTextTools package
================

Why machine learning classification?

-   The manual qualitative coding is time consuming in the social sciences

-   Supervised leaning with the textual data can achieve a new different coding performance

-   It does not the substitute of human coder

RTextTools was designed to make machine learning accessible by providing a start-to-finish product in less than 10 steps.

``` r
library(RTextTools)
library(tidyverse)
library(magrittr)
```

Our frogged data (with 200 samples).

``` r
datafile <- "schoolgids2017v4_frogged_200.rds"
if(!file.exists(datafile)) {
  download.file("https://storage.googleapis.com/schoolgids/schoolgids2017v4/schoolgids2017v4_frogged_200.rds", datafile)
}
tokens <- readRDS(datafile)
```

Tokens nouns.

``` r
tokens_nouns <- tokens[tokens$pos == "N", c("school", "lemma")]
stop_nouns <- c("kind", "school", "groep", "leerling", "ouder", "onderwijs", "leerkracht", "jaar", "schooljaar", "informatie", "activiteit", "ondersteuning", "basisschool", "gesprek", "week", "contact", "directeur", "website", "e-mail", "afspraak", "team", tm::stopwords("dutch") )
tokens_nouns_stop <- tokens_nouns[!grepl(paste(stop_nouns, collapse="|"), tokens_nouns$lemma),]
tokens_nouns_stop <- tokens_nouns_stop[(which(nchar(tokens_nouns_stop$lemma) >= 4)), ] # words less than or equal to 'n' char
```

Meta data matching.

``` r
## Match the gids to rows in our schools table
schools <- read.csv("https://duo.nl/open_onderwijsdata/images/03.-alle-vestigingen-basisonderwijs.csv", sep=";", stringsAsFactors = FALSE)
noun_dtm <- create_dtm(docs = tokens_nouns_stop$school, terms = tokens_nouns_stop$lemma)
gids_id <- substring(rownames(noun_dtm), 1, 6)
gids_info <- schools[match(gids_id, schools$VESTIGINGSNUMMER), c("VESTIGINGSNUMMER", "DENOMINATIE")]
head(gids_info)
```

    ##      VESTIGINGSNUMMER             DENOMINATIE
    ## 571            03XC00 Protestants-Christelijk
    ## 2082           03IZ00         Rooms-Katholiek
    ## 3268           08CP00      Algemeen bijzonder
    ## 21             17FU00                Openbaar
    ## 6296           19ZJ00                Openbaar
    ## 1214           07KC00 Protestants-Christelijk

Accumulating texts into the same cell.

``` r
accumulated <- aggregate(lemma ~ school, data = tokens_nouns_stop, paste, collapse = " ")
names(accumulated) <- c("school", "texts")
names(gids_info) <- c("school", "denominatie")
accumulated <- merge(accumulated, gids_info, by = "school")

table(accumulated$denominatie) #Remove rare ones
```

    ## 
    ##       Algemeen bijzonder           Antroposofisch              Evangelisch 
    ##                       10                        2                        1 
    ## Gereformeerd vrijgemaakt       Interconfessioneel              Islamitisch 
    ##                        3                        1                        1 
    ##                 Openbaar  Protestants-Christelijk           Reformatorisch 
    ##                       58                       50                        1 
    ##          Rooms-Katholiek      Samenwerking PC, RK 
    ##                       67                        1

``` r
accumulated <- accumulated[ ! accumulated$denominatie %in% c("Antroposofisch", "Evangelisch", "Gereformeerd vrijgemaakt", "Interconfessioneel", "Islamitisch", "Reformatorisch", "Samenwerking PC, RK") ,]
accumulated <- accumulated[c("school", "denominatie", "texts")]
accumulated$texts <- iconv(accumulated$texts, "UTF-8", "latin1", sub = " ")

head(accumulated)
```

    ##   school             denominatie
    ## 1 00IJ00 Protestants-Christelijk
    ## 2 01VI00 Protestants-Christelijk
    ## 3 03BY00                Openbaar
    ## 4 03IZ00         Rooms-Katholiek
    ## 5 03LY00         Rooms-Katholiek
    ## 6 03MR00         Rooms-Katholiek
    ##                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       texts
    ## 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           schaapskooi directie kijk kijk doel adres zaak plek gids praktijk bedrijf vraag praktijk lied woord respect kijk norm waard waard veiligheid waard waard plaats plan waard plaats kijk klimaat klimaat veiligheid emotie klimaat waard respect respect kritiek programma vorm kijk drang relatie relatie respect tijd klimaat relatie vrijheid toets moeilijkheid vlak oorsprong respect respect recht plek plek relatie klas klimaat probleem vorm schepsel vaardigheid waard norm doel doel tijd ontw typles rapport doel prestatie score tabel score correctie score correctie score correctie correctie grond soort grafiek belang lijn lijn plicht recht plicht recht plicht kritiek gang zaak probleem klacht probleem klacht zaak klacht zaak zaak zaak zaak klacht taak taak slag klacht klacht brandveiligheid hygiëne klacht richtlijn zaak stagiaire klacht klacht klacht klacht klacht klacht gang zaak directie klimaat respect klacht motto probleem klacht belang klacht belang protocol veiligheidsbeleid sprake spel boek spel doel privacy veiligheidsbeleid veiligheidsbeleid veiligheid belang brandveiligheid veiligheid pestprotocol beeld zaak vraag directie gids groet
    ## 2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                gids gids hart directie adres wijk tijd nitief heid locatie locatie wijk zielhorst locatie grasveld zandbak locatie prijs long park locatie park praktijk lied trefwoord feest heid respect feest begrip saamhorigheid leeftijd praktijk klas sloot voedsel tablet besef zaamheid tafel tafel afstand vreedzaam conflict klas plaats plaats vrijheid sprake tijd raad directielid beleid adres directie stap gang gymles tafel middag middag vorm leesboek spel fase leesvorm programma theek bieb boek heid plaats stap leeftijd motoriek blok kracht film start vaardigheid tijdlijn drama plek tablet digibord brief foto film leeftijd klas heid klas klas toets klas klas klas klas roep klas mavo probleem klas selectie rapie dyslexie gz-psycholoog plaats doel zaak belang vaardigheid type tatie score advies advies lijn doel vraag vraag sprek antwoord vraag probleem plooi middag praktijk regio veiligheid vorm regio vorm toets score arbo-plan arbo-plan actie reanimatie tieavond mail directie stap beet vraag plek vraag kelijk klas wachtlijst sprake sprake conflict vraag klacht klacht bleem klacht klacht klacht politie zaak taak arts arts theologie klacht recht klacht vraag klacht klacht advies klacht loket adres privacy toegang recht directie ligheid sprake bezwaar sprake brief brief bezwaar maat voogdij zaak zaak advies zaak zaak veiligheid pestbeleid advies zaak afscheid sportdag taak taak feest afscheid directie goed bedrijf wijk bank sprake recht sorcontract klacht klacht smaak taak mailadres collega gids klas directie vraag aard land klas klas mail locatie jong locatie contract locatie kracht kracht lijn locatie controle controledag speld richtlijn veiligheid protocol http stap kaart aard mobiel heid mobiel sportfonds fonds kost kost sportfonds vraag taak protocol protocol protocol restrictie directie kelijk directie protocol directie lijst gymbroek zaak feestdag kamp kost conflict traktatie prijs snoep fles richtlijn regio afwezigheid feit vraag afwezigheid aard zaak zaak familielid twijfel belang bezwaar bezwaar bezwaar heid doel toedracht doel aard recht kost bril zaak band sprake rechtsplicht sprake onrechtmatigheid bril belang sprake adres jong locatie locatie locatie locatie locatie locatie locatie locatie concept
    ## 3 woord gids gids klimaat respect plaats gids belang beeld vraag tijd groet woord klacht middag plan leeftijd taak waard norm respect belang leeftijd grondslag vraag vaardigheid vaardigheid probleem ict-vaardigheid maatschappij stap waard belang proces taak passie plek plaats belang respect relatie notie didactiek zaak belang maat variatie vorm vorm vorm toets vaardigheid vaardigheid vaardigheid maatschappij vaardigheid vaardigheid vaardigheid tijd belang proces taak passie feest concept maat vaardigheid tijd leeftijd handvaardigheid vaardigheid maatschappij plan toets toets toets cito-toets toets toets toets taak taak didactiek klimaat gang zaak middag vaardigheid aard probleem regio plaats vraag beeld actie bezwaar arts regio regio probleem probleem coach coach coach antwoord antwoord antwoord vraag probleem antwoord advies probleem maat vraag dagtaak tijd tijd plan planbord planbord planbord planbord taak plan plan planbord kast foto dagtaak plaats skills tablet planbord lijn tijd leesproces tijd blokschrift motoriek handschrift vlot start leesproces lijn boek bibliotheek maatschappij vlot plaats middag passie vaardigheid doel lijn vaardigheidsdoel proces vaardigheid fase vaardigheid theorie vaardigheid land land land vaardigheid respect slag veiligheid hygiëne rots kracht rots vaardigheid rots vaardigheid klas rots cohesie maatschappij belang belang respect proces waard norm proces proces proces respect religie vrijheid begrip kapel stap kraam regio advies advies rapport rapport plaats kamp kamp zaak zang spel familielid afscheid klas feest feest zaak praktijk programma lesprogramma kost kost regio gymles middag gids gids plek feest beeld belang kapstok plaats agressie respect privacy mobiel agressie klas foto vorm woord beeld foto film zwemdag sportdag foto foto film recht foto foto foto film foto film toets toets toets vaardigheid toets toets toets rapportfolio rapportfolio toets avi-toets toets vaardigheid toets toets advies vaardigheid vaardigheid lijn directie vraag klas orthotheek orthotheek toets klas taak probleem plan plan plan probleem advies plan probleem probleem moeilijkheid leesprobleem dyslexie programma dyslexie programma toets klas regio advies platform advies platform platform platform afroep postadres regio vraag plek vraag stap proces vraag tijd tijd recht belang boodschap recht vraag mail relatie advies plaats advies plaats tijd tijd beleid klimaat schoonmaak kwestie factoor plan plan klacht klacht klacht klacht klacht klacht praktijk gang zaak vraag wachtlijst start middag rapport directie poort poort arts tandarts tijdstip afwezigheid afwezigheid recht recht staat sprake twijfel klas nood bewijs familie familiefeest neef nicht neef nicht neef nicht pretpark middag kost bedrag klas brood snoep gang zaak speelplaats locatie plaats speelplaats speelplaats speelplaats plek poort bord toegang speelplaats speelplaats recht klacht exemplaar doel belang vorm recht tablet doel motivatie vaardigheid maatschappij skills vaardigheid maatschappij vaardigheid zaak rapport portfolio vaardigheid programma slag groet 1-2a 1-2b 1-2c email directie toets beeld ambitie ambitie theorie havo theorie havo havo toets toets toets toets stap doel doel stap recht vaardigheid maatschappij vaardigheid kracht vorm leeftijd vorm slag effect slag maatschappij belang belang motivatie snelheid norm waard normbesef begrip respect arbeidsmarkt vaardigheid tablet tijd tablets tablet doel motivatie feit probleem start portfolio rapport portfolio vaardigheid plaats portfolio rapportfolio reactie slag rapportfolio plaats rapportfolio vaardigheid vorm rapportfolio rapportfolio taak motivatie magneet soort feit boek vaardigheid tafel beeld tijd maat beeld beeld toets toets vorm portfolio klimaat vaardigheid rots kracht rots vaardigheid rots vaardigheid rots rots rots zaak rots rots predicaat rots plan streefdoel streefdoel streefdoel tijd protocol plaats feest zaak feedback slag sport doel plan doel slag vaardigheid maat doel klimaat veiligheid veiligheid rots veiligheid kracht vaardigheid rots veiligheid vignet veiligheid plaats feedback doel veiligheid maatschappij vaardigheid vaardigheid hart relatie waard recht klas regio advies platform advies platform platform platform afroep postadres regio vraag plek vraag vraag vorm sprake belang veiligheid veiligheid stap protocol vraag klacht klacht klacht advies klacht probleem klacht klacht klacht klacht gang zaak klacht klacht gang zaak klacht aard klacht aard agressie klacht aard klacht advies klacht klacht plek klacht bevoegdheid klacht klacht klacht klacht regio klacht grond klacht advies klacht klacht klacht advies partij astma arts arts protocol tijd leeftijd recht leeftijd aard begrip aard bedrijfstak probleem feit probleem tijd bezwaar ticket ticket ticket graad graad graad graad graad graad vorm plicht recht plicht moslim feestdag feestdag feest licht paasfeest feestdag biddag arbeid arbeid oorsprong feest feestdag feestdag milad feestdag feestdag adres email vaardigheid vaardigheid probleem ict-vaardigheid maatschappij stap waard slogan vaardigheid maatschappij belang leeftijd grondslag trek programma plaats taak (hoog)begaafdheid rots rots rots programma veiligheid rots rots soort kaart advies kaart hand middag rots klas belang proces taak passie plek plaats belang respect relatie notie didactiek zaak belang maat variatie vaardigheid vaardigheid maatschappij vaardigheid vaardigheid vaardigheid tijd belang proces taak passie probleem rots toilet programma
    ## 4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            email gids gids relatie beleid ambitie doel dorp dorp vorm doel raad email postadres staat respect veiligheid plaats plek lijn veiligheid respect logo logo vorm grondwet hand grondwet grondwet klas beeld doel vaardigheid maatschappij doel doel taak doel doel lesdoel afhankelijkheid doel klimaat vaardigheid lijn beleid taak afwezigheid belang regio afwezigheid collega stagiaire stagiaire stagiaire klas vorm orthotheek directie toegang afstand plek stift probleem speelplaats speeltijd toegang speelplaats traktatie klas klas fles drank potlood blad schrift kladschrift middag tijd praktijk locatie foto foto film foto plan symbool vaardigheid plaats woord probleem tabel grafiek biologie plaats handvaardigheid toneel redzaamheid praktijk vaardigheid respect probleem probleem respect klimaat speelplaats spel spel vormsel vormsel pastoor pastoor sprong biologie sportdag beeld scol toets toets toets plaats rapport rapport plaats paragraaf protocol orthotheek probleem collega toets stap toets score hiaat stap prognose stap stap doel doel tijd plaats effect veiligheid stap stap vraag doel proces doel vraag probleem toets plan plan start licht partij zaak belang toets toets toets toets doel dyslexie klas veiligheid vorm vraag antwoord doel sprake vorm klas antwoord antwoord dyslexie dyslexie probleem dyslexie probleem dyslexie dyslexie handicap handicap acceptatie plaats handicap plaats tijd plicht lijst lijst plaats toets klas toets toets toets toets toets klas toets taak vaardigheid toets advies toets toets type staat grond toets tijd beeld toets advies motivatie vorm advies vorm kost rapport rapport rapport advies rapport vorm toets score score score norm vorm conflict mail stoel zaak belang rapport vorm taak klas klas klas taak klas bedrag bedrag vraag lidmaatschap vraag taak klankbord directie directie zaak adviesrecht formatieplan veiligheid adviesrecht recht exploitatie bedrag brief vraag protocol controle directie arts leeftijd spraak advies vraag vraag hand vraag kijk mail taak probleem leeftijd leeftijd probleem probleem zaak dood arts vraag advies leefklimaat vraag vraag advies leespraat problematiek handicap woord kost kaart soort brief kaart kaart kaart brood middag prijs vraag leeftijd kost kost locatie wijn veiligheidsplan plan protocol veiligheid plan afwezigheid brandslang veiligheid beleid veiligheid programma programma conflict veiligheid beleidsplan respect respect probleem probleem respect belang doel leeftijd beeld directie tijd aard advies recht toets bedrijf tandarts klas tandarts lestijd lesprogramma adres foto woord seks scheldwoord wachtwoord wachtwoord foto foto foto soort taak label zitbank plaats afstand afstand afstand airbag 01-08-2009 veiligheidshes veiligheidshes politie collega sprake stap kaart collega klacht vraag klacht agressie beleid stap probleem email taak klacht klacht klacht secretariaat email klacht probleem probleem klacht probleem directie klacht probleem secretariaat klacht klacht klacht adres klacht klacht klacht klacht klacht advies klacht relatie zaak woord zaak lijn post post onrecht twijfel rechtmatigheid klok raad waarborg bevoegdheid directie tijd gang zaak woord woord directie directie advies directie effect plan smaak recht recht rapport belang sprake directie klacht probleem protocol adres relatie positie conflict grond recht positie rapport kwestie woord sprake feit feit rapport probleem belang kwestie psycholoog advies doel doel vaardigheid programma tijdstip vrijdagmiddag tijd tijd speelplaats (mid)dag adres adres (email)adres klas lijst adres privacy directie privacy adres mailadres zaak vrijdagmiddag schoonmaak postadres adres email email secretariaat vraag tarief email klacht secretariaat email kost leesvaardigheid toets raad rapport raad
    ## 5                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               doel effect veiligheid veiligheidsplan ipods -pads zaak bibliotheek foto gids anti-pestprotocol gids gids plaats prijs exemplaar stad beleid probleem stad parochie helft beleid waard norm parochie taak norm waard programma gang zaak relatie parochie wijk rand wijk beleid collega aspect leidraad actie beleid imago aspect respect aspect aspect aspect maatschappij norm waard praktijk maat relatie vorm klimaat praktijk begaafdheid doel tijd praktijk bord probleem kracht taak tief baar doel vaardigheid beeld oriëntatie oriëntatie schap oriëntatie oriëntatie handvaardigheid spel drama vaardigheid plan redzaamheid zaak effect beeld vorm vraag beeld taat beleid beleid mail zaak stand zaak tijd vraag probleem zaak tijd vraag wezigheid zaak zaak mail zaak brief middag kijk schrift zaak familielid kijk sport speldag zaak woord protocol mail mailadres raad zaak directie formatie taak bevoegdheid adviesrecht raad raad mailadres taak belang feest zaak speldag taak taak mail feest sport speldag bibliotheek directie kost kost sprake smaak taak probleem aard probleem directie directie klacht bevoegdheid klacht zaak zaak feit tijd vorm collega mailadres foto tijd directie plicht wijsveld boodschap afwezigheid leeftijd mail directie wijk wijk wijk wijk plaats rectie vorm proces rapport stap advies pre-advies advies collega toets advies rapport advies rapport cito-toets advies advies advies rapport drempeltoets advies recht sprake sprake veiligheid privacy rots programma veiligheidsplan veiligheid veiligheidsplan speelplaats straat plan veiligheidsplan beleid ligheid plaats brand pand speelplaats middag speelplaats tijd tijd adres speelplaats straat poort speelplaats veiligheid problematiek probleem vraag veiligheid speelplaats cirkel cirkel kaart speelplaats kamp tablet privacy apparaat zaak traktatie snoep heid fantasie kaas worst tijd zaak doel foto foto tijdstip bibliotheek bibliotheek boek leesboek bibliotheek bibliotheek boek boek boek zaak controle controle adres adres foto foto directie foto foto protocol beleid kracht psycholoog probleem actie aspect wijs toets hand rapport kracht stand zaak heid vraag toets programma gang zaak handicap protocol protocol collega plaats psycholoog dagoog psycholoog vorm recht stap slag klas plaats stap collega collega slag stap klas zaak belang kaart advies stap plaats advies beleid vorm waarborg kracht collega ict-taak kracht directie directie taak directie stagiaire prijs problematiek collega recht collega zaak tijd aspect collega borg afscheid leeftijd proces mt-taak tijd locatie locatie collega locatie programma klas rots plek rots programma groei rots proef maat directie praktijk aspect belang directie factoor belang hoogbegaafdheid belang zaak klas proces sprake partij kracht aard bezwaar graad woonplaats graad graad graad graad emigratieplan emigratieland prijs tijd wijk wijk wijk stantie wijk beeld zaak aspect grond grond zaak recht grond factoor belastbaarheid leeftijd type belastbaarheid plaats grond grond grond beletsel rapport rapport rapport advies hand kost directie tijdpad recht grond belastbaarheid belastbaarheid factoor aard probleem aard probleem norm waard problematiek vrees ligheid zaak problematiek aard probleem aard bleem norm waard problematiek sprake directielid tijdstip aard directie e.e.a. directie rest toegang actie grond veiligheid akkoord stap brief directie paragraaf toets toets actie brief protocol afschrift toegang tijd plaats sprek directie bezwaar brief bezwaarschrift lijk sprake score tijd tijd tijdspad plaats twijfel advies toets effect slag kracht tijdspad plaats twijfel advies beleid primaat beleid belang kost e.e.a. tijd taak plan e.e.a. vorm tijd kracht aard tijd aard sprake e.e.a. schakel sprake e.e.a. schakel afschrift zaak
    ## 6                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       woord gids zaak vorm gymtijd belang directie stap tijd groet wijk orthotheek expressie band oorsprong wijk woord klas tijd belang proces vaardigheid vorm facet regie belang belang slot collega doel hart ziel maatstaf plicht norm kracht belang norm waard begrip respect veiligheid maatschappij beleid programma sport vaardigheid wijk stad sprake sport vorm wijk belang partij tijd beleidsplan norm waard tijdschrift begrip respect speelplaats participatie programma tijd programma vaardigheid kritiek conflict staatsvorm grondrecht facet aspect kamp programma belang belang taakspel probleem taakspel taakspel spel doel taak kaart kaart kaart kaart feit vrijdagmiddag taakspel coach vraag programma tablet programma maatschappij probleem ict-vaardigheid maatschappij antwoord coach relatie aspiratie aspect vorm programma actie doel actie veiligheid voet wijk taak relatie vorm lichaam vaardigheid doel oriëntatie oriëntatie drama tafel lotto aspect bibliotheek helft bibliotheek doel maat beet zaakvak vaardigheid vaardigheid drank praktijk politie expressie handvaardigheid drama aspect draad handvaardigheid drama expressie zaakvak expressie plaats aspect maatschappij expositie film gymles sportdag spel sportveld pads i-pads lijn klimaat soemo-kaart tijd tijd middag tijd exemplaar koelkast tijd factoor foto stagiaire spil klas taak directie zaak taak expressie veiligheid sport zaak afwezigheid hand bevoegdheid poort kijk protocol pabo sportcoaches sprake taak adres plek plek leeftijd spel lied plek toneel sport fotografie mail middagles tijd kost tarief directie reactie notitie directie directie rapport belang doel plek plan recht stap klas tijd lijn plaats kaart bevel lijn probleem plan klas kost kost dyslexieprotocol lijn proces lijn proces toets toets feedback cito-toets toets kaart plaats stad plaats preadvies advies toets directie advies advies zaak advies advies rapport correctie score correctie score correctie portfolio rapport rapport rapport vorm portfolio rapport vraag rapport sprake schakel vraag waard vaardigheid klas feit protocol protocol zaak hoogbegaafdheid vraag hoogbegaafdheid hoogbegaafdheid belang klas plaats rest doel vaardigheid taak kritiek proces klas advies beleidsplan advies vraag regio sprake probleem probleem ambitie belang plek taak plek sprake hand type parro-app foto postdag mail post klasbord vraag prijs parro-app zaak brief vraag mail begrip voogd recht soort recht rechtbank macht voogdij gang zaak klas portfolio rapport klas raad sportdag afscheid expressievak o.r.-lid plan belang o.r.-lid foto taak foto G.M.R. klacht klacht probleem probleem veiligheid effect conflict veiligheid klacht klacht brief brief klacht klacht vraag advies klacht brief katholiek paar klacht klacht klacht beleid klacht postadres klacht klacht politie soort klacht vraag politie vraag probleem sprake klacht vorm agressie klacht actie klacht dorst recht maatschappij recht recht plicht lestijd actie tijd file vraag recht zaak beleidsplan vorm beleidsplan veiligheidsbeleid veiligheid veiligheid veiligheidsplan anti-pestprotocol veiligheid veiligheidsbeleid sprake veiligheid veiligheidsbeleid plan veiligheid label directie plan s.v.p. tijd directie brand sprake letsel letsel arts plek protocol veiligheid belang gids belang veiligheid vraag directie probleem pestprotocol respect hand pestprobleem partij probleem directie pestprobleem partij stap stap stap recht plicht probleem oorzaak stap plan partij stap pest fase notitie toedracht notitie pestprotocol protocol sprake stap protocol wijk bibliotheek praktijk vraag vraag vorm kwadrant vraag collega vraag mail cjgbreda mail groei plaats motto klas plaats klas post plaats plaats plaats klas leeftijd advies advies controle hygiëne veiligheid advies twijfel groei beeld digid vraag klas z.s.m. directie collega directie familie brief goed directie sprake taak

Creating a document term matrix.
================================

``` r
doc_matrix <- create_matrix(accumulated$texts, weighting = tm::weightTfIdf)
doc_matrix
```

    ## <<DocumentTermMatrix (documents: 185, terms: 2579)>>
    ## Non-/sparse entries: 29340/447775
    ## Sparsity           : 94%
    ## Maximal term length: 24
    ## Weighting          : term frequency - inverse document frequency (normalized) (tf-idf)

Creating a container
====================

Container is the list of objects that will be fed to the ML algoritms. `accumulated$denominatie` vector is the document label. It is factorized and coerced to numeric as the package requires that.

``` r
container <-
  create_container(
    matrix = doc_matrix,
    labels = as.numeric(factor(accumulated$denominatie)),
    trainSize = 1:165,
    testSize = 166:185,
    virgin = FALSE
  )
```

Training models
===============

The nine algorithms which `RTextTools` provides can be trained and classified (run `print_algorithms()`):

| Argument   | Technique                           | Remarks              |
|:-----------|:------------------------------------|:---------------------|
| "SVM"      | Support vector machine              |                      |
| "GLMNET"   | glmnet                              |                      |
| "MAXENT"   | Maximum entropy                     |                      |
| "SLDA"     | Scaled linear discriminant analysis |                      |
| "BOOSTING" | Boosting                            | (`caTools` pkg)      |
| "BAGGING"  | Bagging                             | (`ipred` pkg)        |
| "RF"       | Random forest                       | (`randomForest` pkg) |
| "NNET"     | Neural networks                     | (`nnet` pkg)         |
| "TREE"     | Classification or regression tree   | (`tree` pkg)         |

Caution: Some techniques takes more time. SVM, GLMNET and MAXENT are low-memory algorithms.

We run a RF model.

``` r
rf <- train_models(container, "RF")
```

Classify data from trained model
================================

``` r
rf_classify <- classify_models(container, rf)
```

Analyzing model
===============

``` r
analytics <- create_analytics(container, rf_classify)
summary(analytics)
```

    ## ENSEMBLE SUMMARY
    ## 
    ##        n-ENSEMBLE COVERAGE n-ENSEMBLE RECALL
    ## n >= 1                   1               0.5
    ## 
    ## 
    ## ALGORITHM PERFORMANCE
    ## 
    ## FORESTS_PRECISION    FORESTS_RECALL    FORESTS_FSCORE 
    ##            0.5275            0.4700            0.4500

As the prediction score is not very high, we are not able to define the school denomination by the words that they are using in the schoolgids.

``` r
compare <- as.data.frame(cbind(as.numeric(factor(accumulated$denominatie))[166:185], rf_classify$FORESTS_LABEL))
colnames(compare) <- c("actual_denominatie", "predicted_denominatie")
compare <- compare %>% mutate(predicted_denominatie = predicted_denominatie - 1)
round(prop.table(table(compare$actual_denominatie == compare$predicted_denominatie)), 3)
```

    ## 
    ## FALSE  TRUE 
    ##  0.75  0.25

------------------------------------------------------------------------

References
==========

Jurka, T., *et al.* (2013). *RTextTools: A Supervised Learning Package for Text Classification.* The R Journal. 5/1. ISSN 2073-4859.
